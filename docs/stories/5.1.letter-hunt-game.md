# Story 5.1: Implement Letter Hunt Game

## Status

Implemented âœ…

**Completion Date:** Pre-existing
**Component:** `/components/games/LetterHunt.tsx`
**Metadata:** `/lib/games/letter-hunt.ts`
**Registration:** Registered in `/lib/games/index.ts`

## Story

**As a** child,
**I want** to find and collect letters in sequence within an interactive scene,
**so that** I can practice spelling in a fun, exploratory way.

## Acceptance Criteria

1. `LetterHunt` component is created in `/components/games/LetterHunt.tsx`
2. Component implements the `GameMechanicProps` interface
3. Component displays an illustrated scene with letters hidden/scattered throughout
4. User must find and click/tap letters in the correct sequence to spell the word
5. Visual/audio feedback when correct letter is found; gentle hint if wrong letter clicked
6. Letters are progressively highlighted or collected as found
7. Game tracks attempts, time taken, hints used
8. Component is categorized as kinesthetic/visual learning style
9. Component supports difficulty: easy (obvious letters), medium (subtle letters), hard (camouflaged letters)

## Tasks / Subtasks

- [ ] Create LetterHunt component (AC: 1, 2)
  - [ ] Create file `/components/games/LetterHunt.tsx`
  - [ ] Implement `GameMechanicProps` interface:
    ```typescript
    interface GameMechanicProps {
      word: string
      difficulty: 'easy' | 'medium' | 'hard'
      onComplete: (result: GameResult) => void
    }
    ```
  - [ ] Setup component state: found letters, current letter index, attempts, hints

- [ ] Design and implement scene layout (AC: 3)
  - [ ] Create interactive scene container (800x600px recommended)
  - [ ] Use free illustration library (unDraw, Humaaans, or similar)
  - [ ] Place letters randomly but strategically in scene
  - [ ] Ensure letters don't overlap and are clickable (min 44x44px touch targets)
  - [ ] Add visual theming (outdoor scene, classroom, playground, etc.)

- [ ] Implement letter positioning logic (AC: 3, 9)
  - [ ] Create function `generateLetterPositions(word, difficulty)`
  - [ ] **Easy difficulty**: Letters placed obviously, high contrast, clear visibility
  - [ ] **Medium difficulty**: Letters more subtle, blended with scene elements
  - [ ] **Hard difficulty**: Letters camouflaged, similar colors to background
  - [ ] Ensure accessibility: letters always findable, not require pixel-perfect clicks

- [ ] Implement letter hunt mechanic (AC: 4, 5, 6)
  - [ ] Display current target letter indicator (e.g., "Find: C")
  - [ ] Handle click/tap on letters in scene
  - [ ] **Correct letter**:
    - Animate letter collection (fly to word display area)
    - Play success sound/visual effect
    - Move to next letter in sequence
  - [ ] **Wrong letter**:
    - Gentle shake animation
    - Play subtle "try again" sound
    - Increment attempts counter
    - Don't penalize heavily (encourage exploration)

- [ ] Implement word display area (AC: 6)
  - [ ] Show word construction area at top of scene
  - [ ] Display empty slots for each letter: `_ _ _`
  - [ ] As letters are found, populate slots: `C _ _` â†’ `C A _` â†’ `C A T`
  - [ ] Highlight current target letter slot

- [ ] Implement hints system (AC: 5, 7)
  - [ ] Add "Hint" button (available based on difficulty)
  - [ ] On hint request:
    - Pulse/glow animation on correct letter
    - Reduce hint count
    - Track hint usage in game result
  - [ ] Hints available: Easy (3), Medium (2), Hard (1)

- [ ] Track game metrics (AC: 7)
  - [ ] Track total attempts (clicks on letters)
  - [ ] Track time taken (start when component mounts)
  - [ ] Track hints used
  - [ ] Calculate isCorrect: word completed successfully
  - [ ] Create `GameResult` object on completion

- [ ] Implement difficulty variations (AC: 9)
  - [ ] **Easy**:
    - Letters are large (48px)
    - High contrast colors
    - Letters appear on solid backgrounds
    - 3 hints available
  - [ ] **Medium**:
    - Letters are medium (36px)
    - Moderate contrast
    - Letters partially integrated with scene
    - 2 hints available
  - [ ] **Hard**:
    - Letters are smaller (28px)
    - Low contrast (camouflaged)
    - Letters fully integrated with scene elements
    - 1 hint available

- [ ] Add animations and feedback (AC: 5, 6)
  - [ ] Use Framer Motion for smooth animations
  - [ ] Letter collection: fly from position to word slot
  - [ ] Wrong click: shake animation
  - [ ] Hint: pulse/glow on target letter
  - [ ] Completion: celebrate with confetti or success animation

- [ ] Update game mechanic registration (AC: 8)
  - [ ] Verify `/lib/games/letter-hunt.ts` exports correct metadata
  - [ ] Update metadata: `learningStyle: ['kinesthetic', 'visual']`
  - [ ] Register in game registry `/lib/games/index.ts`

- [ ] Create component tests
  - [ ] Create test file `/components/games/LetterHunt.test.tsx`
  - [ ] Test: Letters render in scene
  - [ ] Test: Clicking correct letter in sequence works
  - [ ] Test: Clicking wrong letter shows feedback
  - [ ] Test: Word completes when all letters found
  - [ ] Test: Hint system works correctly
  - [ ] Test: Difficulty affects letter visibility
  - [ ] Run tests with `npm run test`

## Dev Notes

### Architecture Context

**File Structure:**
[Source: docs/ui-architecture.md#Project Structure]
```
components/
â”œâ”€â”€ games/
â”‚   â”œâ”€â”€ LetterHunt.tsx          # New component
â”‚   â”œâ”€â”€ LetterHunt.test.tsx     # Tests
â”‚   â””â”€â”€ [existing games...]

lib/
â”œâ”€â”€ games/
â”‚   â”œâ”€â”€ letter-hunt.ts           # Already exists (metadata)
â”‚   â”œâ”€â”€ registry.ts              # Update to register
â”‚   â””â”€â”€ index.ts                 # Export
```

**Game Mechanic Interface:**
[Source: docs/ui-architecture.md#Game Mechanic Interface]
```typescript
interface GameMechanicProps {
  word: string
  difficulty: 'easy' | 'medium' | 'hard'
  onComplete: (result: GameResult) => void
}

interface GameResult {
  wordId: string
  gameType: string
  isCorrect: boolean
  attempts: number
  timestamp: Date
  timeTaken: number      // milliseconds
  hintsUsed: number
}
```

**Letter Hunt Implementation Pattern:**
```typescript
'use client'

import { useState, useEffect } from 'react'
import { motion } from 'framer-motion'
import type { GameMechanicProps, GameResult } from '@/types'

export function LetterHunt({ word, difficulty, onComplete }: GameMechanicProps) {
  const [foundLetters, setFoundLetters] = useState<string[]>([])
  const [currentLetterIndex, setCurrentLetterIndex] = useState(0)
  const [attempts, setAttempts] = useState(0)
  const [hintsUsed, setHintsUsed] = useState(0)
  const [startTime] = useState(Date.now())

  const letters = word.toUpperCase().split('')
  const currentTargetLetter = letters[currentLetterIndex]

  // Generate letter positions based on difficulty
  const letterPositions = generateLetterPositions(letters, difficulty)

  const handleLetterClick = (clickedLetter: string) => {
    setAttempts(prev => prev + 1)

    if (clickedLetter === currentTargetLetter) {
      // Correct letter found
      setFoundLetters([...foundLetters, clickedLetter])
      setCurrentLetterIndex(prev => prev + 1)

      // Check if word is complete
      if (currentLetterIndex === letters.length - 1) {
        completeGame(true)
      }
    } else {
      // Wrong letter clicked - just animate, don't fail
      // Shake animation on wrong letter
    }
  }

  const handleHint = () => {
    setHintsUsed(prev => prev + 1)
    // Pulse animation on correct letter
  }

  const completeGame = (isCorrect: boolean) => {
    const result: GameResult = {
      wordId: word,
      gameType: 'letter-hunt',
      isCorrect,
      attempts,
      timestamp: new Date(),
      timeTaken: Date.now() - startTime,
      hintsUsed
    }
    onComplete(result)
  }

  return (
    <div className="letter-hunt-container">
      {/* Word display area */}
      <div className="word-slots">
        {letters.map((letter, idx) => (
          <div key={idx} className={idx < currentLetterIndex ? 'found' : 'empty'}>
            {idx < currentLetterIndex ? letter : '_'}
          </div>
        ))}
      </div>

      {/* Current target indicator */}
      <div className="target-indicator">
        Find: {currentTargetLetter}
      </div>

      {/* Interactive scene with letters */}
      <div className="scene-container">
        {letterPositions.map((pos, idx) => (
          <motion.button
            key={idx}
            className="letter-button"
            style={{ left: pos.x, top: pos.y }}
            onClick={() => handleLetterClick(pos.letter)}
            whileHover={{ scale: 1.1 }}
            whileTap={{ scale: 0.95 }}
          >
            {pos.letter}
          </motion.button>
        ))}
      </div>

      {/* Hint button */}
      <button onClick={handleHint} disabled={hintsUsed >= getHintLimit(difficulty)}>
        ðŸ’¡ Hint ({getHintLimit(difficulty) - hintsUsed})
      </button>
    </div>
  )
}
```

**Letter Positioning Algorithm:**
```typescript
function generateLetterPositions(
  letters: string[],
  difficulty: 'easy' | 'medium' | 'hard'
) {
  const positions = []
  const sceneWidth = 800
  const sceneHeight = 600
  const letterSize = difficulty === 'easy' ? 48 : difficulty === 'medium' ? 36 : 28

  for (const letter of letters) {
    const x = Math.random() * (sceneWidth - letterSize)
    const y = Math.random() * (sceneHeight - letterSize)

    positions.push({
      letter,
      x,
      y,
      opacity: difficulty === 'hard' ? 0.6 : 1,
      scale: difficulty === 'easy' ? 1.2 : 1
    })
  }

  return positions
}
```

**Illustration Assets:**
[Source: docs/prd.md#Asset Management]
- Use free illustration packs: unDraw, Humaaans, Blush
- Store in `/public/images/games/letter-hunt/`
- SVG format for scalability
- Accessible colors and contrast

### Dependencies

**Required:**
- Epic 3 games (Word Scramble, etc.) - Provides `GameMechanicProps` pattern
- Framer Motion - Already in dependencies for animations

**Integration:**
- Story 4.5 (Adaptive Game Selection) - Will select this game based on learning style
- Story 4.6 (Dynamic Difficulty) - Will set difficulty prop

### Testing

[Source: docs/ui-architecture.md#Testing Strategy]

**Testing Framework:** Vitest + React Testing Library
**Test Location:** `/components/games/LetterHunt.test.tsx`
**Coverage Target:** 70%+

**Test Scenarios:**
```typescript
import { describe, it, expect, vi } from 'vitest'
import { render, screen, fireEvent } from '@testing-library/react'
import { LetterHunt } from './LetterHunt'

describe('LetterHunt Game', () => {
  const mockOnComplete = vi.fn()

  it('renders letters in scene', () => {
    render(<LetterHunt word="cat" difficulty="easy" onComplete={mockOnComplete} />)

    expect(screen.getByText('C')).toBeInTheDocument()
    expect(screen.getByText('A')).toBeInTheDocument()
    expect(screen.getByText('T')).toBeInTheDocument()
  })

  it('finds letters in correct sequence', async () => {
    render(<LetterHunt word="cat" difficulty="easy" onComplete={mockOnComplete} />)

    // Click C (correct)
    fireEvent.click(screen.getByText('C'))
    expect(screen.getByText('Find: A')).toBeInTheDocument()

    // Click A (correct)
    fireEvent.click(screen.getByText('A'))
    expect(screen.getByText('Find: T')).toBeInTheDocument()

    // Click T (correct)
    fireEvent.click(screen.getByText('T'))

    expect(mockOnComplete).toHaveBeenCalledWith(
      expect.objectContaining({
        gameType: 'letter-hunt',
        isCorrect: true
      })
    )
  })

  it('provides hint when requested', () => {
    render(<LetterHunt word="cat" difficulty="medium" onComplete={mockOnComplete} />)

    const hintButton = screen.getByText(/Hint/)
    fireEvent.click(hintButton)

    // Verify hint count decreased
    expect(screen.getByText(/Hint \(1\)/)).toBeInTheDocument()
  })
})
```

**Run Tests:**
```bash
npm run test
```

### Technical Constraints

- Touch targets: Minimum 44x44px for accessibility
- Performance: Scene should render smoothly (60fps)
- Animations: Use Framer Motion for declarative animations
- Accessibility: All letters keyboard accessible (tab navigation)
- Responsive: Scene scales appropriately on mobile

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-20 | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

_To be populated by dev agent_

### Debug Log References

_To be populated by dev agent_

### Completion Notes List

_To be populated by dev agent_

### File List

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_
