# Story 6.8: Word List to Story Mode Navigation

## Status

Draft

## Parent Epic

[Epic 6: Story Mode]

## Dependencies

**Required (Must be complete first):**
- ✅ Story 6.4b: Story Mode Page (story mode exists with hardcoded word list)
- ✅ Story 6.5: Intro & Finale Screens (enhanced story screens completed)
- ✅ Word List Management (existing `/word-lists` page and WordListCard component)

## Story

**As a** player,
**I want** to launch story mode directly from any word list in my collection,
**so that** I can experience narrative-driven practice with my chosen words.

## Acceptance Criteria

1. WordListCard component displays "Start Story" button alongside existing "Play" button
2. "Start Story" button navigates to `/story?listId={wordList.id}` 
3. Story mode page accepts `listId` URL parameter and loads the specified word list
4. Story mode gracefully handles missing or invalid word list IDs with fallback
5. Story intro screen displays the selected word list name correctly
6. Users can navigate back to word lists from story mode via existing "Exit Story" flow
7. URL parameter persists through page refreshes and browser navigation
8. Story mode works identically whether launched with URL parameter or demo word list

## Tasks / Subtasks

- [ ] Add "Start Story" button to WordListCard (AC: 1, 2)
  - [ ] Update `components/word-lists/WordListCard.tsx` 
  - [ ] Add new "Start Story" button with story-themed styling
  - [ ] Position button alongside existing "Edit" and "Play" buttons
  - [ ] Navigate to `/story?listId=${wordList.id}` on click
  - [ ] Add appropriate icon (e.g., book or adventure icon)

- [ ] Update story page to handle URL parameters (AC: 3, 4, 7)
  - [ ] Modify `app/story/page.tsx` to read `listId` from URL params
  - [ ] Add word list loading logic using existing storage functions
  - [ ] Implement fallback to demo word list when `listId` is missing/invalid
  - [ ] Add error handling for deleted or corrupted word lists
  - [ ] Preserve URL params during page refreshes

- [ ] Integrate loaded word list with story machine (AC: 5, 8)
  - [ ] Pass loaded word list to StorySessionMachine input
  - [ ] Ensure word list name displays correctly in intro screen
  - [ ] Verify story generation works with any word list size
  - [ ] Test with various word list themes and content

- [ ] Update navigation and user experience (AC: 6)
  - [ ] Ensure "Exit Story" returns to appropriate page
  - [ ] Update exit dialog to mention returning to word lists
  - [ ] Consider breadcrumb navigation if needed
  - [ ] Test browser back/forward navigation

- [ ] Add error handling and edge cases (AC: 4)
  - [ ] Handle word lists with no words (minimum validation)
  - [ ] Handle very long word lists (performance considerations)
  - [ ] Handle word lists with special characters or formatting
  - [ ] Add user-friendly error messages for invalid scenarios

- [ ] Testing and validation (AC: 8)
  - [ ] Test story mode flow with multiple different word lists
  - [ ] Verify existing demo functionality still works
  - [ ] Test URL parameter edge cases (malformed, missing, etc.)
  - [ ] Validate story progression with user-created word lists

## Dev Notes

**Existing System Integration:**
- `app/story/page.tsx` currently uses hardcoded `demoWordList` 
- `useStoryIntro` hook accepts `wordListId` parameter for intro tracking
- `StorySessionMachine` accepts `wordList` and `wordListId` as input
- `getAllWordLists()` and word list storage functions exist in `lib/storage/localStorage`

**URL Parameter Strategy:**
- Use Next.js `useSearchParams()` hook to read `listId` parameter
- Maintain existing demo word list as fallback when no parameter provided
- Consider using `useRouter()` for programmatic navigation needs

**Component Updates:**
- WordListCard: Add third button with story mode styling
- Story page: Add URL parameter handling and word list loading
- Maintain existing responsive design and button layouts

**Error Handling Approach:**
- Log errors but don't break user experience
- Always fall back to demo word list to ensure story mode works
- Display user-friendly messages for invalid word lists
- Consider showing warning when falling back to demo

**Key Technical Requirements:**
- Preserve existing story mode functionality completely
- Use existing word list storage and loading patterns
- Follow existing URL parameter patterns from `/game?listId=` route
- Maintain TypeScript strict mode compliance

### Testing

**Test Framework:** Vitest with React Testing Library
**Test Location:** 
- `components/word-lists/WordListCard.test.tsx` - Add Start Story button tests
- `app/story/page.test.tsx` - Add URL parameter handling tests
- `__tests__/story-navigation.test.ts` - Integration tests for full flow

**Testing Strategy:**
- Unit tests for WordListCard Start Story button
- Integration tests for URL parameter handling
- End-to-end tests for complete word list → story mode flow
- Error scenario testing (missing lists, invalid IDs)

**User Testing:**
- Verify smooth navigation from word lists to story mode
- Test with various word list sizes and content types
- Validate that story experience feels seamless with user's own words

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-21 | 1.0 | Initial story creation for word list to story mode navigation | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

_To be populated by dev agent_

### Debug Log References  

_To be populated by dev agent_

### Completion Notes List

_To be populated by dev agent_

### File List

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_