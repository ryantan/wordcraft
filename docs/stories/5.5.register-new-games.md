# Story 5.5: Register New Games with Adaptive Engine

## Status

Implemented âœ…

**Completion Date:** Pre-existing
**Implementation:** `/lib/games/index.ts` - All 8 games registered
**Note:** letter-hunt, trace-write, picture-reveal, and word-building are fully registered and integrated with adaptive engine

## Story

**As a** developer,
**I want** to register the 4 new game mechanics with the game session and adaptive engine,
**so that** they're available for selection during game sessions.

## Acceptance Criteria

1. All 4 new games are registered in the game registry
2. Games are correctly categorized by learning style (visual, auditory, kinesthetic)
3. Adaptive engine can query and select from all 8 games
4. Game selection algorithm considers the new games' learning styles
5. All games appear in game session rotation
6. Unit tests verify all 8 games are registered and queryable
7. Integration tests verify adaptive engine selects appropriate games based on learning style

## Tasks / Subtasks

- [ ] Register Letter Hunt game (AC: 1, 2)
  - [ ] Update `/lib/games/index.ts` to export Letter Hunt
  - [ ] Verify metadata in `/lib/games/letter-hunt.ts`:
    - `id: 'letter-hunt'`
    - `learningStyle: ['kinesthetic', 'visual']`
  - [ ] Import and register in game registry

- [ ] Register Trace & Write game (AC: 1, 2)
  - [ ] Update `/lib/games/index.ts` to export Trace & Write
  - [ ] Verify metadata in `/lib/games/trace-write.ts`:
    - `id: 'trace-write'`
    - `learningStyle: ['kinesthetic']`
  - [ ] Import and register in game registry

- [ ] Register Picture Reveal game (AC: 1, 2)
  - [ ] Update `/lib/games/index.ts` to export Picture Reveal
  - [ ] Verify metadata in `/lib/games/picture-reveal.ts`:
    - `id: 'picture-reveal'`
    - `learningStyle: ['visual']`
  - [ ] Import and register in game registry

- [ ] Register Word Building Blocks game (AC: 1, 2)
  - [ ] Update `/lib/games/index.ts` to export Word Building Blocks
  - [ ] Verify metadata in `/lib/games/word-building.ts`:
    - `id: 'word-building'`
    - `learningStyle: ['kinesthetic', 'visual']`
  - [ ] Import and register in game registry

- [ ] Update game registry exports (AC: 1)
  - [ ] Update `/lib/games/index.ts`:
    ```typescript
    export * from './word-scramble'
    export * from './missing-letters'
    export * from './letter-matching'
    export * from './spelling-challenge'
    export * from './letter-hunt'        // NEW
    export * from './trace-write'        // NEW
    export * from './picture-reveal'     // NEW
    export * from './word-building'      // NEW
    ```
  - [ ] Ensure all game metadata exports correctly

- [ ] Update learning style mappings (AC: 2, 4)
  - [ ] Update `/lib/algorithms/learning-style-detection.ts` game mapping:
    ```typescript
    const GAME_STYLES = {
      'word-scramble': ['visual'],
      'missing-letters': ['visual'],
      'letter-matching': ['visual', 'kinesthetic'],
      'spelling-challenge': ['auditory'],
      'letter-hunt': ['kinesthetic', 'visual'],     // NEW
      'trace-write': ['kinesthetic'],               // NEW
      'picture-reveal': ['visual'],                 // NEW
      'word-building': ['kinesthetic', 'visual']    // NEW
    }
    ```

- [ ] Update game difficulty ratings (AC: 4)
  - [ ] Update `/lib/algorithms/game-selection.ts` difficulty mapping:
    ```typescript
    const GAME_DIFFICULTY = {
      'word-scramble': 1,      // Easy
      'letter-matching': 1,    // Easy
      'missing-letters': 2,    // Medium
      'picture-reveal': 2,     // Medium
      'word-building': 2,      // Medium
      'spelling-challenge': 3, // Hard
      'letter-hunt': 3,        // Hard
      'trace-write': 3         // Hard
    }
    ```

- [ ] Verify adaptive engine integration (AC: 3, 5)
  - [ ] Test that `getAllGames()` returns 8 games
  - [ ] Test that `getGame('letter-hunt')` returns Letter Hunt
  - [ ] Test that adaptive engine can select new games
  - [ ] Test that game session machine can load new games

- [ ] Create registry tests (AC: 6)
  - [ ] Create test file `/lib/games/registry.test.ts`
  - [ ] Test: Registry contains 8 games
  - [ ] Test: Each game has required metadata (id, name, learningStyle)
  - [ ] Test: Each game has valid Component
  - [ ] Test: `getGame()` returns correct game
  - [ ] Test: `getAllGames()` returns all 8
  - [ ] Run tests with `npm run test`

- [ ] Create integration tests (AC: 7)
  - [ ] Create test file `/__tests__/integration/game-selection.test.ts`
  - [ ] Test: Visual learner profile gets visual games (including Picture Reveal)
  - [ ] Test: Kinesthetic learner gets kinesthetic games (including Letter Hunt, Trace & Write, Word Building)
  - [ ] Test: Balanced profile gets balanced mix of all 8 games
  - [ ] Test: Game variety maintained (no game repeats consecutively)
  - [ ] Run tests with `npm run test`

- [ ] Update documentation
  - [ ] Update `/docs/adaptive-engine-guide.md` with new games
  - [ ] Document learning style categorizations
  - [ ] Document difficulty ratings
  - [ ] List all 8 available games

## Dev Notes

### Architecture Context

**Game Registry Pattern:**
[Source: docs/ui-architecture.md#Game Registry]

The registry provides a central place for all game mechanics:

```typescript
// lib/games/registry.ts
import { letterHuntMechanic } from './letter-hunt'
import { traceWriteMechanic } from './trace-write'
import { pictureRevealMechanic } from './picture-reveal'
import { wordBuildingMechanic } from './word-building'
// ... existing game imports

// Auto-register all games on import
export function initializeGameRegistry() {
  gameRegistry.register('letter-hunt', letterHuntMechanic)
  gameRegistry.register('trace-write', traceWriteMechanic)
  gameRegistry.register('picture-reveal', pictureRevealMechanic)
  gameRegistry.register('word-building', wordBuildingMechanic)
  // ... register existing games
}

// Call initialization
initializeGameRegistry()
```

**Complete Game List:**
```typescript
// All 8 games with metadata
const ALL_GAMES = [
  // Epic 3 Games
  { id: 'word-scramble', learningStyle: ['visual'], difficulty: 1 },
  { id: 'missing-letters', learningStyle: ['visual'], difficulty: 2 },
  { id: 'letter-matching', learningStyle: ['visual', 'kinesthetic'], difficulty: 1 },
  { id: 'spelling-challenge', learningStyle: ['auditory'], difficulty: 3 },

  // Epic 5 Games
  { id: 'letter-hunt', learningStyle: ['kinesthetic', 'visual'], difficulty: 3 },
  { id: 'trace-write', learningStyle: ['kinesthetic'], difficulty: 3 },
  { id: 'picture-reveal', learningStyle: ['visual'], difficulty: 2 },
  { id: 'word-building', learningStyle: ['kinesthetic', 'visual'], difficulty: 2 }
]
```

**Learning Style Distribution:**
- **Visual**: 5 games (Word Scramble, Missing Letters, Letter Matching, Letter Hunt, Picture Reveal)
- **Kinesthetic**: 5 games (Letter Matching, Letter Hunt, Trace & Write, Word Building)
- **Auditory**: 1 game (Spelling Challenge) - will expand when audio added

**Difficulty Distribution:**
- **Easy** (1): Word Scramble, Letter Matching
- **Medium** (2): Missing Letters, Picture Reveal, Word Building
- **Hard** (3): Spelling Challenge, Letter Hunt, Trace & Write

### Dependencies

**Required:**
- Story 5.1 (Letter Hunt) - MUST be complete
- Story 5.2 (Trace & Write) - MUST be complete
- Story 5.3 (Picture Reveal) - MUST be complete
- Story 5.4 (Word Building Blocks) - MUST be complete
- Story 4.4 (Learning Style Detection) - Provides style mapping
- Story 4.5 (Adaptive Game Selection) - Uses registered games

### Testing

[Source: docs/ui-architecture.md#Testing Strategy]

**Testing Framework:** Vitest
**Test Locations:**
- `/lib/games/registry.test.ts` - Registry tests
- `/__tests__/integration/game-selection.test.ts` - Integration tests

**Registry Test Scenarios:**
```typescript
import { describe, it, expect } from 'vitest'
import { gameRegistry, getAllGames, getGame } from './registry'

describe('Game Registry', () => {
  it('contains all 8 games', () => {
    const games = getAllGames()
    expect(games).toHaveLength(8)
  })

  it('retrieves games by ID', () => {
    const letterHunt = getGame('letter-hunt')
    expect(letterHunt).toBeDefined()
    expect(letterHunt?.meta.id).toBe('letter-hunt')
  })

  it('all games have required metadata', () => {
    const games = getAllGames()

    games.forEach(game => {
      expect(game.meta.id).toBeDefined()
      expect(game.meta.name).toBeDefined()
      expect(game.meta.learningStyle).toBeDefined()
      expect(game.Component).toBeDefined()
    })
  })

  it('new Epic 5 games are registered', () => {
    expect(getGame('letter-hunt')).toBeDefined()
    expect(getGame('trace-write')).toBeDefined()
    expect(getGame('picture-reveal')).toBeDefined()
    expect(getGame('word-building')).toBeDefined()
  })
})
```

**Integration Test Scenarios:**
```typescript
import { describe, it, expect } from 'vitest'
import { selectGame } from '@/lib/algorithms/game-selection'

describe('Game Selection with All 8 Games', () => {
  it('selects from all 8 games for balanced profile', () => {
    const balancedProfile = { visual: 0.33, kinesthetic: 0.33, auditory: 0.34 }
    const selections = []

    for (let i = 0; i < 100; i++) {
      const game = selectGame('word', balancedProfile, 0.5, [])
      selections.push(game)
    }

    const uniqueGames = new Set(selections)
    expect(uniqueGames.size).toBeGreaterThan(6) // Most games should appear
  })

  it('favors kinesthetic games for kinesthetic learner', () => {
    const kProfile = { visual: 0.1, kinesthetic: 0.8, auditory: 0.1 }
    const selections = []

    for (let i = 0; i < 100; i++) {
      const game = selectGame('word', kProfile, 0.5, [])
      selections.push(game)
    }

    const kinestheticGames = selections.filter(g =>
      ['letter-hunt', 'trace-write', 'word-building', 'letter-matching'].includes(g)
    )

    expect(kinestheticGames.length).toBeGreaterThan(60)
  })
})
```

**Run Tests:**
```bash
npm run test
npm run test:coverage
```

### Technical Constraints

- Registry must be initialized before game sessions start
- All games must implement `GameMechanicProps` interface
- Learning style categorizations must be accurate
- Difficulty ratings should reflect actual game complexity

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-20 | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

_To be populated by dev agent_

### Debug Log References

_To be populated by dev agent_

### Completion Notes List

_To be populated by dev agent_

### File List

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_
